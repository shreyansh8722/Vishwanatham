import{j as e,k as ae,P as re,u as ne,v as ie,A as U,m as Y,e as oe,w as le,a as ce,g as de,x as me,X as xe}from"./ui-vendor-DvYRwaTC.js";import{r as i,b as pe}from"./react-vendor-BrYn47dg.js";import{N as he,F as ue}from"./Footer-BU4Q99GI.js";import{b as ge,d as K,a as ye,c as J}from"./index-BaMFXKro.js";import{q as H,l as Q,m as fe,r as X,w as V}from"./firebase-vendor-ChDbu2GB.js";import{u as be,a as je,o as Ne,s as g}from"./schemas-IBkb4Gt7.js";const ve=({selectedAddress:o,onSelect:l,onAddNew:D})=>{const{user:j}=ge(),[y,c]=i.useState([]),[v,p]=i.useState(!0);return i.useEffect(()=>{if(!j){p(!1);return}(async()=>{try{const d=H(Q(K,`users/${j.uid}/addresses`),fe("createdAt","desc")),w=await X(d);c(w.docs.map(C=>({id:C.id,...C.data()})))}catch(d){console.error("Failed to load addresses",d)}finally{p(!1)}})()},[j]),v?e.jsx("div",{className:"text-xs text-gray-400 py-4",children:"Loading saved addresses..."}):y.length===0?null:e.jsxs("div",{className:"space-y-3 mb-6 animate-in fade-in duration-500",children:[e.jsx("p",{className:"text-sm font-bold text-gray-700 mb-2",children:"Saved Addresses"}),e.jsx("div",{className:"grid gap-3",children:y.map(r=>{const d=(o==null?void 0:o.address)===r.street&&(o==null?void 0:o.pincode)===r.pincode;return e.jsxs("div",{onClick:()=>l(r),className:`relative p-4 border rounded-sm cursor-pointer flex items-start gap-3 transition-all ${d?"border-[#B08D55] bg-[#B08D55]/5 ring-1 ring-[#B08D55]":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:`mt-1 w-4 h-4 rounded-full border flex items-center justify-center flex-shrink-0 ${d?"border-[#B08D55] bg-[#B08D55]":"border-gray-300"}`,children:d&&e.jsx(ae,{size:10,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold text-gray-900",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[r.street,", ",r.city]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[r.state," - ",r.pincode]}),e.jsxs("p",{className:"text-xs text-gray-800 mt-1 font-medium",children:["Ph: ",r.phone]})]})]},r.id)})}),e.jsxs("button",{type:"button",onClick:D,className:"w-full py-3 mt-2 border border-dashed border-gray-300 text-gray-500 text-xs font-bold uppercase tracking-wider hover:border-[#B08D55] hover:text-[#B08D55] transition-all flex items-center justify-center gap-2 rounded-sm",children:[e.jsx(re,{size:14})," Add New Address"]}),e.jsxs("div",{className:"relative flex py-2 items-center",children:[e.jsx("div",{className:"flex-grow border-t border-gray-200"}),e.jsx("span",{className:"flex-shrink-0 mx-4 text-gray-400 text-[10px] uppercase",children:"Or enter manually"}),e.jsx("div",{className:"flex-grow border-t border-gray-200"})]})]})},we=Ne({firstName:g().min(2,"First name is too short"),lastName:g().min(2,"Last name is too short"),email:g().email("Invalid email address"),phone:g().regex(/^[0-9]{10}$/,"Phone number must be 10 digits"),address:g().min(10,"Address is too short (min 10 chars)"),city:g().min(2,"City name is required"),state:g().min(2,"State is required"),pincode:g().regex(/^[0-9]{6}$/,"Pincode must be 6 digits")}),Ce=()=>new Promise(o=>{const l=document.createElement("script");l.src="https://checkout.razorpay.com/v1/checkout.js",l.onload=()=>o(!0),l.onerror=()=>o(!1),document.body.appendChild(l)});function ze(){var E;const o=pe(),{cart:l,cartTotal:D,clearCart:j}=ye(),y=D||0,[c,v]=i.useState(1),[p,r]=i.useState("cod"),[d,w]=i.useState(!1),[C,A]=i.useState(!0),[S,O]=i.useState(""),[f,z]=i.useState(null),[k,I]=i.useState(0),[P,b]=i.useState({type:"",text:""}),[$,_]=i.useState(!1),{register:h,handleSubmit:R,formState:{errors:t},setValue:m,getValues:N,trigger:Z}=be({resolver:je(we),defaultValues:{firstName:"",lastName:"",email:((E=J.currentUser)==null?void 0:E.email)||"",phone:"",address:"",city:"",state:"",pincode:""}}),L=y-k;i.useLayoutEffect(()=>{window.scrollTo(0,0)},[]),i.useEffect(()=>{l.length},[l,o]);const G=async()=>{if(S.trim()){_(!0),b({type:"",text:""});try{const s=H(Q(K,"coupons"),V("code","==",S.toUpperCase()),V("isActive","==",!0)),x=await X(s);if(x.empty)b({type:"error",text:"Invalid coupon code"});else{const n=x.docs[0].data();if(n.expiryDate&&new Date(n.expiryDate.toDate())<new Date){b({type:"error",text:"Coupon has expired"});return}if(n.minPurchase&&y<n.minPurchase){b({type:"error",text:`Min spend ₹${n.minPurchase} required`});return}let a=0;n.type==="percentage"?(a=y*n.value/100,n.maxDiscount&&(a=Math.min(a,n.maxDiscount))):a=n.value,I(a),z({...n,id:x.docs[0].id}),b({type:"success",text:`Coupon applied! You saved ₹${a}`})}}catch(s){console.error(s),b({type:"error",text:"Could not verify coupon"})}finally{_(!1)}}},W=()=>{z(null),I(0),O(""),b({type:"",text:""})},ee=s=>{const[x,...n]=s.name.split(" ");m("firstName",x||""),m("lastName",n.join(" ")||""),m("phone",s.phone),m("address",s.street),m("city",s.city),m("state",s.state),m("pincode",s.pincode),Z(),A(!1)},F=s=>{v(2),window.scrollTo({top:0,behavior:"smooth"})},se=async()=>{w(!0);const s=N();try{if(p==="online"){if(!await Ce()){alert("Razorpay SDK failed to load. Check your internet."),w(!1);return}const a=await(await fetch("https://us-central1-YOUR_PROJECT_ID.cloudfunctions.net/createOrder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:l,deliveryDetails:s,couponCode:f?f.code:null})})).json();if(!a.success)throw new Error(a.error);const te={key:"YOUR_RAZORPAY_KEY_ID",amount:a.amount,currency:a.currency,name:"Pahnawa Banaras",description:"Authentic Heritage Silk",order_id:a.orderId,handler:async function(B){var T;try{const M=await(await fetch("https://us-central1-YOUR_PROJECT_ID.cloudfunctions.net/verifyPayment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:B.razorpay_order_id,razorpay_payment_id:B.razorpay_payment_id,razorpay_signature:B.razorpay_signature,orderDetails:{userId:((T=J.currentUser)==null?void 0:T.uid)||"guest",userEmail:s.email,shippingDetails:s,items:a.items,subtotal:a.amount/100,totalAmount:a.amount/100,paymentMethod:"Online",couponCode:f?f.code:null}})})).json();M.success?(j&&j(),o("/order-success",{state:{orderId:M.orderId}})):alert("Payment verification failed! Please contact support.")}catch(q){console.error(q),alert("Payment verified but order creation failed. Contact support.")}},prefill:{name:`${s.firstName} ${s.lastName}`,email:s.email,contact:s.phone},theme:{color:"#B08D55"}};new window.Razorpay(te).open()}else alert("Cash on Delivery is currently disabled for this premium setup. Please use Online Payment.")}catch(x){console.error("Order failed:",x),alert(`Failed to place order: ${x.message}`)}finally{w(!1)}},u=s=>`border p-3 rounded-sm w-full text-sm outline-none focus:border-[#B08D55] transition-colors ${s?"border-red-500 bg-red-50":"border-gray-200"}`;return e.jsxs("div",{className:"min-h-screen bg-[#F9F9F9] font-sans text-brand-dark",children:[e.jsx(he,{}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 md:py-12",children:[e.jsxs("div",{className:"mb-8 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>c===1?o(-1):v(1),className:"p-2 -ml-2 text-gray-500 hover:text-black",children:e.jsx(ne,{size:20})}),e.jsx("h1",{className:"font-serif text-2xl text-gray-900",children:"Checkout"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 md:gap-12",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-6",children:[e.jsxs("div",{className:`bg-white p-6 md:p-8 rounded-sm shadow-sm border transition-all duration-300 ${c===1?"border-[#B08D55] ring-1 ring-[#B08D55]/20":"border-gray-100 opacity-60"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"font-serif text-xl flex items-center gap-3 text-gray-900",children:[e.jsx("span",{className:`w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold ${c>1?"bg-green-600 text-white":"bg-[#B08D55] text-white"}`,children:c>1?e.jsx(ie,{size:14}):"1"}),"Shipping Address"]}),c>1&&e.jsx("button",{onClick:()=>v(1),className:"text-xs text-[#B08D55] font-bold uppercase hover:underline",children:"Edit"})]}),e.jsx(U,{children:c===1&&e.jsxs(Y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:[e.jsx(ve,{onSelect:ee,onAddNew:()=>{m("firstName",""),m("address",""),m("pincode",""),A(!0)}}),C?e.jsxs("form",{id:"shipping-form",onSubmit:R(F),className:"grid grid-cols-1 md:grid-cols-2 gap-5 mt-4",children:[e.jsxs("div",{children:[e.jsx("input",{...h("firstName"),placeholder:"First Name *",className:u(t.firstName)}),t.firstName&&e.jsx("p",{className:"text-red-500 text-[10px] mt-1",children:t.firstName.message})]}),e.jsxs("div",{children:[e.jsx("input",{...h("lastName"),placeholder:"Last Name *",className:u(t.lastName)}),t.lastName&&e.jsx("p",{className:"text-red-500 text-[10px] mt-1",children:t.lastName.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("input",{...h("email"),type:"email",placeholder:"Email Address *",className:u(t.email)}),t.email&&e.jsx("p",{className:"text-red-500 text-[10px] mt-1",children:t.email.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("input",{...h("phone"),type:"tel",placeholder:"Phone Number (10 digits) *",className:u(t.phone),maxLength:10}),t.phone&&e.jsx("p",{className:"text-red-500 text-[10px] mt-1",children:t.phone.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("input",{...h("address"),placeholder:"Street Address *",className:u(t.address)}),t.address&&e.jsx("p",{className:"text-red-500 text-[10px] mt-1",children:t.address.message})]}),e.jsxs("div",{children:[e.jsx("input",{...h("city"),placeholder:"City *",className:u(t.city)}),t.city&&e.jsx("p",{className:"text-red-500 text-[10px] mt-1",children:t.city.message})]}),e.jsxs("div",{children:[e.jsx("input",{...h("state"),placeholder:"State *",className:u(t.state)}),t.state&&e.jsx("p",{className:"text-red-500 text-[10px] mt-1",children:t.state.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("input",{...h("pincode"),placeholder:"Pincode (6 digits) *",className:u(t.pincode),maxLength:6}),t.pincode&&e.jsx("p",{className:"text-red-500 text-[10px] mt-1",children:t.pincode.message})]}),e.jsx("div",{className:"md:col-span-2 mt-4",children:e.jsxs("button",{type:"submit",className:"w-full bg-black text-white py-4 text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition-all shadow-lg rounded-sm flex justify-center items-center gap-2",children:["Continue to Payment ",e.jsx(oe,{size:16})]})})]}):e.jsxs("div",{className:"bg-gray-50 p-4 border border-gray-200 rounded-sm",children:[e.jsxs("p",{className:"font-bold text-sm",children:[N("firstName")," ",N("lastName")]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[N("address"),", ",N("city")," - ",N("pincode")]}),e.jsx("button",{onClick:R(F),className:"w-full mt-4 bg-black text-white py-3 text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition-all rounded-sm",children:"Continue with this Address"})]})]})})]}),e.jsxs("div",{className:`bg-white p-6 md:p-8 rounded-sm shadow-sm border transition-all duration-300 ${c===2?"border-[#B08D55] ring-1 ring-[#B08D55]/20":"border-gray-100 opacity-60"}`,children:[e.jsxs("h2",{className:"font-serif text-xl mb-6 flex items-center gap-3 text-gray-900",children:[e.jsx("span",{className:`w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold ${c===2?"bg-[#B08D55] text-white":"bg-gray-200 text-gray-500"}`,children:"2"}),"Payment Method"]}),e.jsx(U,{children:c===2&&e.jsxs(Y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},className:"space-y-4 overflow-hidden",children:[e.jsxs("label",{className:`flex items-center p-4 border rounded-sm cursor-pointer transition-all ${p==="online"?"border-[#B08D55] bg-[#B08D55]/5":"border-gray-200"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"online",checked:p==="online",onChange:()=>r("online"),className:"accent-[#B08D55] w-4 h-4"}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-sm text-gray-900",children:"Pay Online"}),e.jsx(le,{size:20,className:"text-gray-400"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"UPI, Cards, Netbanking (Recommended)"})]})]}),e.jsxs("label",{className:`flex items-center p-4 border rounded-sm cursor-pointer transition-all ${p==="cod"?"border-[#B08D55] bg-[#B08D55]/5":"border-gray-200"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"cod",checked:p==="cod",onChange:()=>r("cod"),className:"accent-[#B08D55] w-4 h-4"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("span",{className:"font-bold text-sm text-gray-900",children:"Cash on Delivery"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pay in cash upon delivery"})]})]}),e.jsx("button",{onClick:se,disabled:d,className:"w-full mt-6 bg-[#B08D55] text-white py-4 text-sm font-bold uppercase tracking-widest hover:bg-[#8c6a40] transition-all shadow-lg disabled:bg-gray-400 flex justify-center items-center gap-2 rounded-sm",children:d?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"animate-spin",size:16})," Processing..."]}):`Pay ₹${L.toLocaleString("en-IN")}`}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-400 text-[10px] uppercase tracking-wider mt-4",children:[e.jsx(de,{size:14})," 100% Secure Payment"]})]})})]})]}),e.jsx("div",{className:"lg:col-span-5",children:e.jsxs("div",{className:"bg-white p-6 shadow-sm border border-gray-100 rounded-sm sticky top-24",children:[e.jsx("h3",{className:"font-serif text-lg mb-4 pb-4 border-b border-gray-100 text-gray-900",children:"Order Summary"}),e.jsx("div",{className:"space-y-4 mb-6 max-h-60 overflow-y-auto pr-2 scrollbar-hide",children:l.map(s=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-16 h-20 bg-gray-100 rounded-sm overflow-hidden flex-shrink-0 border border-gray-100",children:e.jsx("img",{src:s.featuredImageUrl,alt:s.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 line-clamp-2 leading-tight",children:s.name}),e.jsxs("div",{className:"flex justify-between mt-2 items-end",children:[e.jsx("div",{className:"text-xs text-gray-500 space-y-0.5",children:e.jsxs("p",{children:["Qty: ",s.quantity]})}),e.jsxs("p",{className:"text-sm font-bold text-gray-900",children:["₹",(s.price*s.quantity).toLocaleString("en-IN")]})]})]})]},s.cartItemId||s.id))}),e.jsxs("div",{className:"py-4 border-t border-b border-gray-100 mb-4",children:[f?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-sm p-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-bold text-green-700 uppercase flex items-center gap-1",children:[e.jsx(me,{size:12})," ",f.code]}),e.jsx("p",{className:"text-[10px] text-green-600",children:"Savings applied successfully"})]}),e.jsx("button",{onClick:W,className:"text-gray-400 hover:text-red-500",children:e.jsx(xe,{size:16})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{placeholder:"Coupon Code",className:"flex-1 border border-gray-300 rounded-sm px-3 py-2 text-sm uppercase outline-none focus:border-[#B08D55]",value:S,onChange:s=>O(s.target.value)}),e.jsx("button",{onClick:G,disabled:!S||$,className:"bg-gray-900 text-white px-4 py-2 text-xs font-bold uppercase tracking-wide rounded-sm hover:bg-black disabled:bg-gray-300",children:$?"...":"Apply"})]}),P.text&&!f&&e.jsx("p",{className:`text-[10px] mt-2 ${P.type==="error"?"text-red-500":"text-green-600"}`,children:P.text})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",y.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{className:"text-green-700 font-bold text-xs uppercase",children:"Free"})]}),k>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-medium",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["- ₹",k.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-xl text-gray-900 pt-4 border-t border-gray-100 mt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",L.toLocaleString("en-IN")]})]})]})]})})]})]}),e.jsx(ue,{})]})}export{ze as default};
